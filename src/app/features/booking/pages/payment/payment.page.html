<div class="min-h-screen bg-gray-50">
  <!-- Step progress bar -->
  <app-booking-progress-bar></app-booking-progress-bar>

  <div class="mx-auto max-w-7xl px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left: Payment methods + coupon -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-5">
          <h2 class="text-xl font-extrabold text-gray-900 mb-4">Payment</h2>

          <!-- Methods -->
          <div class="flex flex-wrap gap-3 mb-5">
            <label class="flex items-center gap-2 px-3 py-2 rounded-lg border hover:border-rose-400 cursor-pointer transition"
                   [class]="paymentMethod==='card_credit' ? 'border-rose-500 ring-2 ring-rose-200' : 'border-gray-300'">
              <input type="radio" name="method" class="accent-rose-600"
                     [checked]="paymentMethod==='card_credit'"
                     (change)="paymentMethod='card_credit'">
              <span class="font-semibold text-gray-800">Credit Card</span>
            </label>

            <label class="flex items-center gap-2 px-3 py-2 rounded-lg border hover:border-rose-400 cursor-pointer transition"
                   [class]="paymentMethod==='card_debit' ? 'border-rose-500 ring-2 ring-rose-200' : 'border-gray-300'">
              <input type="radio" name="method" class="accent-rose-600"
                     [checked]="paymentMethod==='card_debit'"
                     (change)="paymentMethod='card_debit'">
              <span class="font-semibold text-gray-800">Debit Card</span>
            </label>

            <label class="flex items-center gap-2 px-3 py-2 rounded-lg border hover:border-rose-400 cursor-pointer transition"
                   [class]="paymentMethod==='upi' ? 'border-rose-500 ring-2 ring-rose-200' : 'border-gray-300'">
              <input type="radio" name="method" class="accent-rose-600"
                     [checked]="paymentMethod==='upi'"
                     (change)="paymentMethod='upi'">
              <span class="font-semibold text-gray-800">UPI</span>
            </label>
          </div>

          <!-- Card form -->
          <form *ngIf="paymentMethod==='card_credit' || paymentMethod==='card_debit'"
                [formGroup]="cardForm" (submit)="$event.preventDefault()" class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Cardholder Name</label>
              <input type="text" formControlName="name" placeholder="Name on card"
                     class="w-full h-11 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-rose-300">
              <p class="mt-1 text-sm text-rose-600" *ngIf="cardForm.controls.name.touched && cardForm.controls.name.invalid">
                Enter a valid name
              </p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Card Number</label>
              <input type="text" formControlName="number" placeholder="16-digit number" maxlength="16" inputmode="numeric"
                     class="w-full h-11 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-rose-300">
              <p class="mt-1 text-sm text-rose-600" *ngIf="cardForm.controls.number.touched && cardForm.controls.number.invalid">
                Enter a valid 16-digit number
              </p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Expiry (MM/YY)</label>
                <input type="text" formControlName="expiry" placeholder="MM/YY" maxlength="5"
                       class="w-full h-11 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-rose-300">
                <p class="mt-1 text-sm text-rose-600" *ngIf="cardForm.controls.expiry.touched && cardForm.controls.expiry.invalid">
                  Enter a valid expiry
                </p>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">CVV</label>
                <input type="password" formControlName="cvv" placeholder="CVV" maxlength="4" inputmode="numeric"
                       class="w-full h-11 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-rose-300">
                <p class="mt-1 text-sm text-rose-600" *ngIf="cardForm.controls.cvv.touched && cardForm.controls.cvv.invalid">
                  Enter a valid CVV
                </p>
              </div>
            </div>

            <label class="inline-flex items-center gap-2 mt-1">
              <input type="checkbox" formControlName="save" class="h-4 w-4 rounded accent-rose-600">
              <span class="text-sm text-gray-700">Securely save this card for future</span>
            </label>
          </form>

          <!-- UPI form -->
          <form *ngIf="paymentMethod==='upi'" [formGroup]="upiForm" (submit)="$event.preventDefault()" class="space-y-3">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">UPI ID</label>
              <input type="text" formControlName="upiId" placeholder="yourname@bank"
                     class="w-full h-11 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-rose-300">
              <p class="mt-1 text-sm text-rose-600" *ngIf="upiForm.controls.upiId.touched && upiForm.controls.upiId.invalid">
                Enter a valid UPI ID
              </p>
            </div>
            <p class="text-sm text-gray-500">You will be asked to approve the payment in your UPI app.</p>
          </form>

          <!-- Coupon -->
          <div class="mt-6">
            <label class="block text-sm font-extrabold text-gray-900 mb-2">Have a coupon?</label>
            <div class="flex flex-col sm:flex-row gap-2">
              <input #cp type="text" placeholder="Enter code e.g., SAVE50"
                     class="flex-1 h-11 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-rose-300">
              <button type="button"
                      class="h-11 px-4 rounded-lg bg-red-500 text-white font-extrabold hover:bg-rose-700 transition disabled:opacity-60"
                      [disabled]="applying"
                      (click)="applyCoupon(cp.value)">
                {{ applying ? 'Applying…' : 'Apply' }}
              </button>
              <button *ngIf="couponApplied"
                      type="button"
                      class="h-11 px-4 rounded-lg border border-rose-500 text-rose-600 font-extrabold hover:bg-rose-50"
                      (click)="removeCoupon()">
                Remove
              </button>
            </div>
            <p class="mt-1 text-sm text-emerald-700" *ngIf="couponApplied">
              Applied: {{ couponApplied}}
            </p>
            <p class="mt-1 text-sm text-rose-600" *ngIf="couponError">
              {{ couponError }}
            </p>
          </div>

          <div class="mt-6">
            <button type="button"
                    class="w-full h-12 rounded-xl bg-red-500 text-white font-extrabold shadow-sm hover:bg-rose-700 transition"
                    (click)="payNow()">
              Pay ₹{{ payable() | number:'1.2-2' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Right: Sidebar (your BookingSummary) -->
      <aside>
        <app-booking-summary></app-booking-summary>
      </aside>
    </div>
  </div>
</div>